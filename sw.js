"use strict";(()=>{var l=new Uint8Array([73,65,71,80]),w=16,S=12,b=1e5,A=256,E="SHA-256",g="AES-GCM",a;if(typeof crypto<"u"&&crypto.subtle)a=crypto.subtle;else if(typeof globalThis<"u"&&globalThis.crypto&&globalThis.crypto.subtle)a=globalThis.crypto.subtle;else try{a=(0,eval)("require")("crypto").webcrypto.subtle}catch{}function f(){if(a)return a;throw new Error("Web Crypto API is not available in this environment")}async function v(t){let n=new TextEncoder;return f().importKey("raw",n.encode(t),{name:"PBKDF2"},!1,["deriveBits","deriveKey"])}async function x(t,n){return f().deriveKey({name:"PBKDF2",salt:n,iterations:b,hash:E},t,{name:g,length:A},!1,["encrypt","decrypt"])}async function u(t,n){if(t.length<l.length)return t;for(let o=0;o<l.length;o++)if(t[o]!==l[o])return t;let r=l.length,e=r+w,s=e+S;if(t.length<s)throw new Error("Invalid encrypted data format: too short");let y=t.slice(r,e),p=t.slice(e,s),c=t.slice(s),i=await v(n),m=await x(i,y);try{let o=await f().decrypt({name:g,iv:p},m,c);return new Uint8Array(o)}catch{throw new Error("Decryption failed. Wrong password?")}}var d=null,h={html:"text/html",css:"text/css",js:"text/javascript",json:"application/json",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",svg:"image/svg+xml",ico:"image/x-icon",woff:"font/woff",woff2:"font/woff2",ttf:"font/ttf",eot:"application/vnd.ms-fontobject",txt:"text/plain",xml:"application/xml",pdf:"application/pdf"};self.addEventListener("install",t=>{self.skipWaiting()});self.addEventListener("activate",t=>{t.waitUntil(self.clients.claim())});self.addEventListener("message",t=>{t.data&&t.data.type==="SET_PASSWORD"&&(d=t.data.password,t.source&&t.source.postMessage({type:"PASSWORD_SET"}))});self.addEventListener("fetch",t=>{let n=new URL(t.request.url);if(n.origin!==self.location.origin||!d)return;let r=n.pathname;(r==="/"||r==="/index.html")&&(r="/__index.html"),t.respondWith((async()=>{try{let e=await fetch(r);if(!e.ok)return e;let s=await e.arrayBuffer(),y=new Uint8Array(s),p=await u(y,d),c="application/octet-stream",i=r.split(".").pop()?.toLowerCase();return i&&h[i]&&(c=h[i]),new Response(p,{status:200,headers:{"Content-Type":c,"Cache-Control":"no-store"}})}catch(e){return console.error("Decryption failed or fetch error",e),fetch(t.request)}})())});})();
